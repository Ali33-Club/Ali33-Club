<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω CLB Pickleball - Firebase</title>
    <style>
        :root {
            --color-primary: #208791;
            --color-primary-hover: #186e7e;
            --color-primary-active: #157170;
            --color-text: #134252;
            --color-text-secondary: #626c7c;
            --color-bg: #fcfcf9;
            --color-surface: #fffffe;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #22c75a;
            --color-error: #c0152f;
            --color-warning: #a84b2f;
            --radius: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            padding: 16px;
            line-height: 1.5;
        }

        .container { max-width: 700px; margin: 0 auto; }
        header {
            text-align: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--color-primary);
        }

        header h1 { font-size: 24px; color: var(--color-primary); margin-bottom: 4px; }
        header p { color: var(--color-text-secondary); font-size: 14px; }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: rgba(34, 199, 90, 0.1);
            border: 1px solid rgba(34, 199, 90, 0.3);
            border-radius: var(--radius);
            margin-bottom: 16px;
            font-size: 12px;
            color: #1a8a3a;
        }

        .sync-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c75a;
        }

        .sync-status.loading {
            background: rgba(168, 75, 47, 0.1);
            border-color: rgba(168, 75, 47, 0.3);
            color: #a84b2f;
        }

        .sync-status.loading .sync-indicator {
            background: #a84b2f;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--color-border);
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 16px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 150ms;
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .form-group { margin-bottom: 16px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
            color: var(--color-text);
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            font-size: 14px;
            font-family: inherit;
            color: var(--color-text);
            background: var(--color-surface);
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(32, 135, 145, 0.15);
        }

        .btn {
            width: 100%;
            padding: 12px 16px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 150ms;
            margin-top: 8px;
        }

        .btn:hover { background: var(--color-primary-hover); }
        .btn.success { background: var(--color-success); }
        .btn.success:hover { background: #1a8a3a; }
        .btn.danger { background: var(--color-error); }
        .btn.danger:hover { background: #a0121f; }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .row .form-group { margin-bottom: 0; }

        .member-list { margin-top: 16px; }
        .member-item {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .member-name { font-weight: 600; }
        .member-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(32, 135, 145, 0.1);
            color: var(--color-primary);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .member-badge.guest {
            background: rgba(165, 75, 47, 0.1);
            color: #a84b2f;
        }

        .delete-btn {
            background: var(--color-error);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 150ms;
        }

        .delete-btn:hover { background: #a0121f; }

        .match-item {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .match-info { flex: 1; }
        .match-players { font-weight: 600; margin-bottom: 4px; font-size: 14px; }
        .match-score { font-size: 12px; color: var(--color-text-secondary); }

        .payment-item {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .payment-name { font-weight: 600; font-size: 16px; }
        .money {
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .money.positive { color: var(--color-success); }
        .money.negative { color: var(--color-error); }

        .total-payment {
            background: rgba(32, 135, 145, 0.1);
            border: 2px solid var(--color-primary);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
            margin-top: 20px;
        }

        .total-payment-label { font-size: 14px; color: var(--color-text-secondary); margin-bottom: 8px; }
        .total-payment-value { font-size: 32px; font-weight: 700; color: var(--color-primary); font-family: 'Courier New', monospace; }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .ranking-table thead {
            background: var(--color-primary);
            color: white;
        }

        .ranking-table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }

        .ranking-table td {
            padding: 12px;
            border-bottom: 1px solid var(--color-border);
            font-size: 14px;
        }

        .ranking-table tbody tr:hover { background: rgba(32, 135, 145, 0.05); }

        .rank-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--color-primary);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 14px;
        }

        .rank-1 { background: #ffd700; color: #333; }
        .rank-2 { background: #c0c0c0; color: #333; }
        .rank-3 { background: #cd7f32; color: white; }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--color-text-secondary);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            border-radius: var(--radius);
            color: white;
            animation: slideIn 0.3s ease;
            z-index: 1000;
            max-width: 300px;
            font-size: 14px;
        }

        .notification.success { background: var(--color-success); }
        .notification.error { background: var(--color-error); }
        .notification.info { background: var(--color-primary); }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        h2 { font-size: 18px; margin-top: 16px; margin-bottom: 12px; color: var(--color-text); }
        h3 { font-size: 14px; margin: 16px 0 8px 0; color: var(--color-text); }

        .payment-date-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-primary);
            margin: 16px 0 12px 0;
        }

        .info-text { font-size: 12px; color: var(--color-text-secondary); margin-top: 8px; }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèì Qu·∫£n L√Ω CLB Pickleball</h1>
            <p>T√≠nh ti·ªÅn + Firebase Cloud Sync</p>
        </header>

        <div class="sync-status" id="syncStatus">
            <span class="sync-indicator"></span>
            <span id="syncText">S·∫µn s√†ng ƒë·ªìng b·ªô</span>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(event, 'members')">üë• VƒêV</button>
            <button class="tab-btn" onclick="switchTab(event, 'schedule')">üìÖ L·ªãch</button>
            <button class="tab-btn" onclick="switchTab(event, 'matches')">üéæ Tr·∫≠n</button>
            <button class="tab-btn" onclick="switchTab(event, 'payment')">üí≥ Ti·ªÅn</button>
            <button class="tab-btn" onclick="switchTab(event, 'ranking-money')">üí∞ BXH Ti·ªÅn</button>
            <button class="tab-btn" onclick="switchTab(event, 'ranking-skill')">‚≠ê BXH Tr√¨nh</button>
            <button class="tab-btn" onclick="switchTab(event, 'ranking-score')">üèÜ BXH ƒêi·ªÉm</button>
            <button class="tab-btn" onclick="switchTab(event, 'backup')">üíæ Backup</button>
            <button class="tab-btn" onclick="switchTab(event, 'settings')">üîê C√†i ƒê·∫∑t</button>
        </div>

        <!-- Tab VƒêV -->
        <div id="members" class="tab-content active">
            <h2>‚ûï Th√™m Th√†nh Vi√™n/Kh√°ch</h2>
            <div class="row">
                <div class="form-group">
                    <label>T√™n VƒêV</label>
                    <input type="text" id="memberName" placeholder="Nh·∫≠p t√™n">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i</label>
                    <select id="memberType">
                        <option value="club">Th√†nh Vi√™n CLB</option>
                        <option value="guest">Kh√°ch</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="addMember()">‚ûï Th√™m VƒêV</button>

            <h2>üë• Danh S√°ch Th√†nh Vi√™n</h2>
            <div class="member-list" id="membersList"></div>
        </div>

        <!-- Tab L·ªãch Sinh Ho·∫°t -->
        <div id="schedule" class="tab-content">
            <h2>üìÖ Th√™m L·ªãch Sinh Ho·∫°t</h2>
            <div class="row">
                <div class="form-group">
                    <label>Ng√†y Sinh Ho·∫°t (dd/mm/yyyy)</label>
                    <input type="text" id="scheduleDate" placeholder="01/12/2025">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Ghi Ch√∫ (t√πy ch·ªçn)</label>
                    <input type="text" id="scheduleNote" placeholder="V√≠ d·ª•: V√≤ng 1, B√°n k·∫øt...">
                </div>
            </div>
            <button class="btn" onclick="addSchedule()">üìÖ Th√™m Ng√†y</button>

            <h2>Danh S√°ch L·ªãch Sinh Ho·∫°t (M·ªõi nh·∫•t tr√™n c√πng)</h2>
            <div class="member-list" id="scheduleList"></div>
        </div>

        <!-- Tab Tr·∫≠n ƒê·∫•u -->
        <div id="matches" class="tab-content">
            <h2>üéæ Ghi L·∫°i Tr·∫≠n ƒê·∫•u</h2>
            <div class="form-group">
                <label>Ch·ªçn Ng√†y Sinh Ho·∫°t</label>
                <select id="eventDate">
                    <option value="">-- Ch·ªçn ng√†y --</option>
                </select>
            </div>

            <h3>C·∫∑p 1</h3>
            <div class="row">
                <div class="form-group">
                    <label>VƒêV 1</label>
                    <select id="pair1a">
                        <option value="">-- Ch·ªçn --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>VƒêV 2</label>
                    <select id="pair1b">
                        <option value="">-- Ch·ªçn --</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>T·ª∑ S·ªë</label>
                <input type="number" id="score1" placeholder="15" min="0">
            </div>

            <h3>C·∫∑p 2</h3>
            <div class="row">
                <div class="form-group">
                    <label>VƒêV 1</label>
                    <select id="pair2a">
                        <option value="">-- Ch·ªçn --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>VƒêV 2</label>
                    <select id="pair2b">
                        <option value="">-- Ch·ªçn --</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>T·ª∑ S·ªë</label>
                <input type="number" id="score2" placeholder="10" min="0">
            </div>

            <button class="btn" onclick="addMatch()">‚ûï Th√™m Tr·∫≠n ƒê·∫•u</button>

            <h2>Danh S√°ch Tr·∫≠n ƒê·∫•u</h2>
            <div class="member-list" id="matchList"></div>
        </div>

        <!-- Tab T√≠nh Ti·ªÅn -->
        <div id="payment" class="tab-content">
            <h2>üí≥ B·∫£ng T√≠nh Ti·ªÅn</h2>
            <div class="form-group">
                <label>Ch·ªçn Ng√†y Sinh Ho·∫°t</label>
                <select id="paymentDate">
                    <option value="">-- Ch·ªçn ng√†y --</option>
                </select>
            </div>
            <div id="paymentList"></div>
        </div>

        <!-- Tab BXH Ti·ªÅn -->
        <div id="ranking-money" class="tab-content">
            <h2>üí∞ B·∫£ng X·∫øp H·∫°ng Ti·ªÅn (NƒÉm D∆∞∆°ng L·ªãch)</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>T√™n VƒêV</th>
                        <th>Tr·∫≠n</th>
                        <th>Ti·ªÅn (k)</th>
                    </tr>
                </thead>
                <tbody id="rankingMoneyBody">
                    <tr>
                        <td colspan="4" class="empty-state" style="padding: 40px 20px;">Ch∆∞a c√≥ d·ªØ li·ªáu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab BXH Tr√¨nh ƒê·ªô -->
        <div id="ranking-skill" class="tab-content">
            <h2>‚≠ê B·∫£ng X·∫øp H·∫°ng Tr√¨nh ƒê·ªô (‚â•5 Tr·∫≠n)</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>T√™n VƒêV</th>
                        <th>Tr·∫≠n</th>
                        <th>Th·∫Øng %</th>
                    </tr>
                </thead>
                <tbody id="rankingSkillBody">
                    <tr>
                        <td colspan="4" class="empty-state" style="padding: 40px 20px;">Ch∆∞a c√≥ d·ªØ li·ªáu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab BXH ƒêi·ªÉm S·ªë -->
        <div id="ranking-score" class="tab-content">
            <h2>üèÜ B·∫£ng X·∫øp H·∫°ng ƒêi·ªÉm S·ªë</h2>
            <table class="ranking-table">
                <thead>
                    <tr>
                        <th>H·∫°ng</th>
                        <th>T√™n VƒêV</th>
                        <th>W/L</th>
                        <th>ƒêi·ªÉm</th>
                        <th>Hi·ªáu S·ªë</th>
                    </tr>
                </thead>
                <tbody id="rankingScoreBody">
                    <tr>
                        <td colspan="5" class="empty-state" style="padding: 40px 20px;">Ch∆∞a c√≥ d·ªØ li·ªáu</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Tab C√†i ƒê·∫∑t -->
        <div id="settings" class="tab-content">
            <h2>üîê C√†i ƒê·∫∑t B·∫£o M·∫≠t</h2>
            <div class="form-group">
                <label>
                    <strong>‚ö†Ô∏è Ch·∫ø ƒê·ªô Xem (Ch·ªâ ƒê·ªçc) - Lu√¥n B·∫≠t</strong>
                </label>
                <p class="info-text" style="margin-top: 8px;">Ch·∫ø ƒë·ªô xem lu√¥n ƒë∆∞·ª£c b·∫≠t v√† ƒë·ªìng b·ªô v·ªõi Cloud. Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ t·∫Øt ch·∫ø ƒë·ªô xem.</p>
                <button class="btn" id="toggleReadOnlyBtn" style="background: var(--color-warning); margin-top: 12px;" onclick="toggleReadOnlyWithPassword()">üîì T·∫Øt Ch·∫ø ƒê·ªô Xem</button>
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label>Thay ƒê·ªïi M·∫≠t Kh·∫©u Admin</label>
                <input type="password" id="adminPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
            </div>

            <button class="btn" onclick="setAdminPassword()">üîë Thay ƒê·ªïi M·∫≠t Kh·∫©u</button>

            <div class="info-text" style="margin-top: 20px; background: rgba(192, 21, 47, 0.1); padding: 12px; border-radius: 8px;">
                ‚ö†Ô∏è <strong>Ch·∫ø ƒê·ªô Xem:</strong> Ng∆∞·ªùi kh√°c ch·ªâ c√≥ th·ªÉ xem, kh√¥ng th·ªÉ th√™m/x√≥a/s·ª≠a<br>
                ‚ö†Ô∏è <strong>M·∫≠t Kh·∫©u:</strong> B·∫£o v·ªá khi t·∫Øt ch·∫ø ƒë·ªô xem (n·∫øu c√≥)<br>
                ‚ö†Ô∏è <strong>L∆∞u √Ω:</strong> M·∫≠t kh·∫©u ƒë∆∞·ª£c l∆∞u tr√™n m√°y n√†y, kh√¥ng ph·∫£i cloud
            </div>

            <h3 style="margin-top: 30px;">Tr·∫°ng Th√°i Hi·ªán T·∫°i</h3>
            <div class="payment-item">
                <div class="payment-name">Ch·∫ø ƒê·ªô</div>
                <div><span id="modeStatus" class="money negative">üîí Ch·ªâ Xem (B·∫≠t)</span></div>
            </div>
            <div class="payment-item">
                <div class="payment-name">M·∫≠t Kh·∫©u</div>
                <div><span id="pwdStatus" class="money positive">‚úì ƒê√£ ƒê·∫∑t</span></div>
            </div>
            <div class="payment-item">
                <div class="payment-name">ƒê·ªìng B·ªô Cloud</div>
                <div><span id="syncStatus2" class="money positive">‚úì T·ª± ƒê·ªông</span></div>
            </div>
        </div>

        <!-- Tab Backup -->
        <div id="backup" class="tab-content">
            <h2>üíæ Sao L∆∞u & ƒê·ªìng B·ªô</h2>
            <button class="btn success" onclick="toggleAutoSync()" id="autoSyncBtn">üîÑ T·ª± ƒê·ªông ƒê·ªìng B·ªô Firebase</button>
            <button class="btn" onclick="manualSaveFirebase()">üíæ L∆∞u L√™n Firebase Ngay</button>
            <button class="btn" onclick="manualLoadFirebase()">üì• T·∫£i T·ª´ Firebase</button>
            <button class="btn" onclick="exportData()">üì• T·∫£i V·ªÅ (JSON)</button>
            <button class="btn danger" onclick="clearAllData()">üóëÔ∏è X√≥a T·∫•t C·∫£</button>

            <div class="info-text" style="margin-top: 20px; background: rgba(34, 199, 90, 0.1); padding: 12px; border-radius: 8px;">
                ‚úì D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr√™n m√°y t√≠nh + Firebase Cloud<br>
                ‚úì 100% offline - kh√¥ng c·∫ßn internet<br>
                ‚úì T·ª± ƒë·ªông ƒë·ªìng b·ªô khi c√≥ thay ƒë·ªïi
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA1Zq6yiWwLFzY9w2G2pir_5cvSFtOTjPk",
            authDomain: "ali33-6d285.firebaseapp.com",
            databaseURL: "https://ali33-6d285-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ali33-6d285",
            storageBucket: "ali33-6d285.firebasestorage.app",
            messagingSenderId: "50398279647",
            appId: "1:50398279647:web:6213d0b2e6bfa8fd75366a"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let members = JSON.parse(localStorage.getItem('members')) || [];
        let schedules = JSON.parse(localStorage.getItem('schedules')) || [];
        let matches = JSON.parse(localStorage.getItem('matches')) || [];
        let readOnlyMode = true;
        let adminPassword = localStorage.getItem('adminPassword') || 'Ali34';

        function switchTab(event, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'ranking-money') updateRankingMoney();
            else if (tabName === 'ranking-skill') updateRankingSkill();
            else if (tabName === 'ranking-score') updateRankingScore();
            else if (tabName === 'settings') updateSettingsUI();
        }

        function updateSettingsUI() {
            document.getElementById('modeStatus').textContent = readOnlyMode ? 'üîí Ch·ªâ Xem (B·∫≠t)' : '‚úÖ Ch·ªânh S·ª≠a (M·ªü)';
            document.getElementById('modeStatus').className = readOnlyMode ? 'money negative' : 'money positive';
            document.getElementById('pwdStatus').textContent = '‚úì ƒê√£ ƒê·∫∑t: ' + adminPassword;
            document.getElementById('syncStatus2').textContent = '‚úì T·ª± ƒê·ªông';
        }

        function toggleReadOnlyWithPassword() {
            const pwd = prompt('Nh·∫≠p m·∫≠t kh·∫©u admin ƒë·ªÉ t·∫Øt ch·∫ø ƒë·ªô xem:');
            if (!pwd) return;
            if (pwd !== adminPassword) {
                showNotification('M·∫≠t kh·∫©u sai! Ch·∫ø ƒë·ªô xem v·∫´n b·∫≠t.', 'error');
                return;
            }
            readOnlyMode = false;
            applyReadOnlyMode();
            showNotification('‚úì Ch·∫ø ƒë·ªô ch·ªânh s·ª≠a ƒë√£ b·∫≠t - 5 ph√∫t', 'success');
            updateSettingsUI();
            setTimeout(() => {
                readOnlyMode = true;
                applyReadOnlyMode();
                showNotification('‚è±Ô∏è Quay l·∫°i ch·∫ø ƒë·ªô xem', 'info');
                updateSettingsUI();
            }, 300000);
        }

        function setAdminPassword() {
            const newPwd = document.getElementById('adminPassword').value.trim();
            if (!newPwd) {
                showNotification('M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng', 'error');
                return;
            }
            const currentPwd = prompt('Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i ƒë·ªÉ x√°c nh·∫≠n:');
            if (currentPwd !== adminPassword) {
                showNotification('M·∫≠t kh·∫©u hi·ªán t·∫°i sai!', 'error');
                return;
            }
            localStorage.setItem('adminPassword', newPwd);
            adminPassword = newPwd;
            showNotification('‚úì M·∫≠t kh·∫©u ƒë√£ thay ƒë·ªïi', 'success');
            document.getElementById('adminPassword').value = '';
            updateSettingsUI();
            autoSync();
        }

        function applyReadOnlyMode() {
            const buttonSelectors = ['.btn:not(#autoSyncBtn):not(#toggleReadOnlyBtn)', '.delete-btn'];
            const inputSelectors = ['#memberName', '#scheduleDate', '#scheduleNote', '#score1', '#score2', '#adminPassword'];
            
            inputSelectors.forEach(sel => {
                const elem = document.querySelector(sel);
                if (elem) elem.disabled = readOnlyMode;
            });

            buttonSelectors.forEach(sel => {
                document.querySelectorAll(sel).forEach(btn => {
                    if (btn.textContent.includes('Firebase') || btn.textContent.includes('T·∫£i') || btn.textContent.includes('X√≥a T·∫•t')) {
                        return;
                    }
                    btn.disabled = readOnlyMode;
                    btn.style.opacity = readOnlyMode ? '0.5' : '1';
                    btn.style.cursor = readOnlyMode ? 'not-allowed' : 'pointer';
                });
            });
        }

        function addMember() {
            const name = document.getElementById('memberName').value.trim();
            const type = document.getElementById('memberType').value;
            if (!name) {
                showNotification('Vui l√≤ng nh·∫≠p t√™n VƒêV', 'error');
                return;
            }
            if (members.some(m => m.name.toLowerCase() === name.toLowerCase())) {
                showNotification('VƒêV n√†y ƒë√£ c√≥ trong danh s√°ch', 'error');
                return;
            }
            members.push({ id: Date.now(), name, type });
            saveData();
            showNotification(`‚úì ƒê√£ th√™m VƒêV: ${name}`, 'success');
            document.getElementById('memberName').value = '';
            updateMembersList();
            updatePairSelects();
            autoSync();
        }

        function deleteMember(id) {
            if (confirm('X√≥a VƒêV n√†y?')) {
                members = members.filter(m => m.id !== id);
                saveData();
                updateMembersList();
                updatePairSelects();
                showNotification('ƒê√£ x√≥a VƒêV', 'success');
                autoSync();
            }
        }

        function updateMembersList() {
            const html = members.map(m => `
                <div class="member-item">
                    <div><div class="member-name">${m.name}<span class="member-badge ${m.type === 'guest' ? 'guest' : ''}">${m.type === 'club' ? 'Th√†nh Vi√™n' : 'Kh√°ch'}</span></div></div>
                    <button class="delete-btn" onclick="deleteMember(${m.id})">X√≥a</button>
                </div>
            `).join('') || '<div class="empty-state"><p>Ch∆∞a c√≥ th√†nh vi√™n</p></div>';
            document.getElementById('membersList').innerHTML = html;
        }

        function addSchedule() {
            const dateInput = document.getElementById('scheduleDate').value.trim();
            const note = document.getElementById('scheduleNote').value.trim();
            if (!dateInput) {
                showNotification('Vui l√≤ng nh·∫≠p ng√†y', 'error');
                return;
            }
            const dateRegex = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            const match = dateInput.match(dateRegex);
            if (!match) {
                showNotification('ƒê·ªãnh d·∫°ng ng√†y kh√¥ng h·ª£p l·ªá (dd/mm/yyyy)', 'error');
                return;
            }
            const [_, day, month, year] = match;
            const date = `${year}-${month}-${day}`;
            if (schedules.some(s => s.date === date)) {
                showNotification('Ng√†y n√†y ƒë√£ c√≥ trong l·ªãch', 'error');
                return;
            }
            schedules.push({ id: Date.now(), date, note, displayDate: dateInput });
            schedules.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveData();
            showNotification('‚úì ƒê√£ th√™m ng√†y sinh ho·∫°t', 'success');
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleNote').value = '';
            updateScheduleList();
            updateScheduleSelects();
            autoSync();
        }

        function deleteSchedule(id) {
            if (confirm('X√≥a ng√†y sinh ho·∫°t n√†y?')) {
                schedules = schedules.filter(s => s.id !== id);
                saveData();
                updateScheduleList();
                updateScheduleSelects();
                showNotification('ƒê√£ x√≥a ng√†y sinh ho·∫°t', 'success');
                autoSync();
            }
        }

        function updateScheduleList() {
            const sortedSchedules = [...schedules].sort((a, b) => new Date(b.date) - new Date(a.date));
            const html = sortedSchedules.map(s => {
                const dateStr = s.displayDate || new Date(s.date).toLocaleDateString('vi-VN');
                const matchCount = matches.filter(m => m.date === s.date).length;
                return `
                    <div class="match-item">
                        <div class="match-info">
                            <div class="match-players"><strong>${dateStr}</strong></div>
                            <div class="match-score">${s.note || 'Kh√¥ng c√≥ ghi ch√∫'} ‚Ä¢ ${matchCount} tr·∫≠n</div>
                        </div>
                        <button class="delete-btn" onclick="deleteSchedule(${s.id})">X√≥a</button>
                    </div>
                `;
            }).join('') || '<div class="empty-state"><p>Ch∆∞a c√≥ l·ªãch sinh ho·∫°t</p></div>';
            document.getElementById('scheduleList').innerHTML = html;
        }

        function updateScheduleSelects() {
            const selectEventDate = document.getElementById('eventDate');
            const selectPaymentDate = document.getElementById('paymentDate');
            
            const optionsHtml = '<option value="">-- Ch·ªçn ng√†y --</option>' +
                schedules.map(s => `<option value="${s.date}">${s.displayDate || new Date(s.date).toLocaleDateString('vi-VN')}${s.note ? ` (${s.note})` : ''}</option>`).join('');
            
            selectEventDate.innerHTML = optionsHtml;
            selectPaymentDate.innerHTML = optionsHtml;
        }

        function updatePairSelects() {
            const playerNames = members.map(m => m.name);
            const selectIds = ['pair1a', 'pair1b', 'pair2a', 'pair2b'];
            selectIds.forEach(id => {
                const elem = document.getElementById(id);
                elem.innerHTML = '<option value="">-- Ch·ªçn --</option>' + playerNames.map(p => `<option value="${p}">${p}</option>`).join('');
            });
        }

        function addMatch() {
            const date = document.getElementById('eventDate').value;
            const p1a = document.getElementById('pair1a').value;
            const p1b = document.getElementById('pair1b').value;
            const p2a = document.getElementById('pair2a').value;
            const p2b = document.getElementById('pair2b').value;
            const score1 = parseInt(document.getElementById('score1').value) || 0;
            const score2 = parseInt(document.getElementById('score2').value) || 0;

            if (!date) {
                showNotification('Vui l√≤ng ch·ªçn ng√†y sinh ho·∫°t', 'error');
                return;
            }
            if (!p1a || !p1b || !p2a || !p2b) {
                showNotification('Vui l√≤ng ch·ªçn ƒë·ªß 4 VƒêV', 'error');
                return;
            }
            const allPlayers = [p1a, p1b, p2a, p2b];
            if (new Set(allPlayers).size !== 4) {
                showNotification('C√°c VƒêV kh√¥ng ƒë∆∞·ª£c tr√πng nhau', 'error');
                return;
            }

            const pair1 = `${p1a} - ${p1b}`;
            const pair2 = `${p2a} - ${p2b}`;

            matches.push({
                id: Date.now(),
                date,
                pair1,
                pair2,
                score1,
                score2,
                result1: score1 > score2 ? 'win' : 'lose',
                result2: score2 > score1 ? 'win' : 'lose'
            });

            saveData();
            showNotification(`‚úì Th√™m tr·∫≠n: ${pair1} ${score1} - ${score2} ${pair2}`, 'success');
            document.getElementById('score1').value = '';
            document.getElementById('score2').value = '';
            document.getElementById('pair1a').value = '';
            document.getElementById('pair1b').value = '';
            document.getElementById('pair2a').value = '';
            document.getElementById('pair2b').value = '';
            updateMatchList();
            updatePaymentList();
            autoSync();
        }

        function updateMatchList() {
            const dateFilter = document.getElementById('eventDate').value;
            const filtered = dateFilter ? matches.filter(m => m.date === dateFilter) : matches;
            const html = filtered.slice().reverse().map(m => `
                <div class="match-item">
                    <div class="m
